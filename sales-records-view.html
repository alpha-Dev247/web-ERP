<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Records</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* shadow-md */
            padding: 1.5rem; /* Standard padding for content cards */
        }
        .section-header {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700; /* font-bold */
            color: #1f2937; /* gray-900 */
            margin-bottom: 1rem;
            border-bottom: 2px solid #F89D2F; /* Orange accent line */
            padding-bottom: 0.5rem;
        }
        .detail-action-button {
            background-color: #F89D2F; /* Specific Orange for buttons */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s ease-in-out;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .detail-action-button:hover {
            background-color: #D28528; /* Darker orange on hover */
        }
        .detail-action-button.outline {
            background-color: transparent;
            color: #F89D2F;
            border: 1px solid #F89D2F;
            box-shadow: none;
        }
        .detail-action-button.outline:hover {
            background-color: #ffe7d6; /* Light orange on hover */
        }
        
        /* Form element styling */
        .form-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem; /* rounded-lg */
            font-size: 0.9rem;
            color: #374151; /* gray-700 */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .form-field:focus {
            outline: none;
            border-color: #F89D2F; /* Orange border on focus */
            box-shadow: 0 0 0 3px rgba(248, 157, 47, 0.3); /* Orange ring on focus */
        }
        .form-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #4b5563; /* gray-600 */
            margin-bottom: 0.5rem;
        }

        /* Responsive grid for main sections */
        .sales-records-grid {
            display: grid;
            gap: 1.5rem; /* Gap between cards */
            grid-template-columns: repeat(1, minmax(0, 1fr)); /* Default to single column */
        }
        @media (min-width: 768px) { /* Medium screens */
            .sales-records-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr)); /* Two columns */
            }
        }
        @media (min-width: 1024px) { /* Large screens */
            .sales-records-grid {
                grid-template-columns: repeat(4, minmax(0, 1fr)); /* Four columns */
            }
        }
        /* Specific column spans for larger sections */
        .col-span-2 {
            grid-column: span 2 / span 2;
        }
        @media (min-width: 1024px) {
            .lg\:col-span-2 {
                grid-column: span 2 / span 2;
            }
            .lg\:col-span-1 {
                grid-column: span 1 / span 1;
            }
            .lg\:col-start-3 {
                grid-column-start: 3;
            }
            .lg\:row-start-1 {
                grid-row-start: 1;
            }
        }

        /* Course section specific styling */
        .course-table-container {
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            overflow: auto; /* Changed from hidden to auto for scrollability */
            flex-grow: 1; /* Allow it to grow in flex container */
            display: flex;
            flex-direction: column; /* Organize content vertically */
        }
        .course-table-wrapper {
            flex-grow: 1;
            overflow-y: auto; /* Enable vertical scrolling within the table wrapper */
        }
        .course-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            text-align: left;
        }
        .course-table th, .course-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap; /* Prevent wrapping in table cells */
        }
        .course-table thead {
            background-color: #f9fafb;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            position: sticky; /* Make header sticky */
            top: 0; /* Stick to the top */
            z-index: 1; /* Ensure it stays above scrolling content */
        }
        .course-table tbody tr:last-child td {
            border-bottom: none;
        }
        .course-table tbody tr:hover {
            background-color: #f3f4f6;
        }

        /* Message Box for notifications */
        .message-box {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            color: white;
            z-index: 1000;
            display: none; /* Hidden by default */
        }
        .message-box.info { background-color: #3b82f6; } /* blue-500 */
        .message-box.success { background-color: #22c55e; } /* green-500 */
        .message-box.error { background-color: #ef4444; } /* red-500 */
    </style>
</head>
<body class="p-8">

    <div class="container mx-auto">
        <div class="mb-6">
            <a href="Sales Administrator.html" class="detail-action-button outline">
                <i class="fas fa-arrow-left"></i> Back to Sales Administrator
            </a>
        </div>

        <h1 class="text-3xl font-bold text-gray-800 mb-8">Sales Records</h1>

        <div class="sales-records-grid">

            <!-- Section 1: ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô -->
            <div class="card lg:col-span-1">
                <h2 class="section-header">1.‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="space-y-4">
                    <div>
                        <label for="student-id-card" class="form-label">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                        <input type="text" id="idCard" class="form-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô">
                        <button id="search-student-button" class="detail-action-button mt-2">
                          üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                        </button>
                      </div>
                    <div>
                        <label for="student-code" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <input type="text" id="studentCode" class="form-field" placeholder="">
                    </div>
                    <div>
                        <label for="student-name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á</label>
                        <input type="text" id="firstName" class="form-field" placeholder="" readonly>
                    </div>
                    <div>
                        <label for="student-surname" class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="lastName" class="form-field" placeholder="" readonly>
                    </div>
                    <div>
                        <label for="student-nickname" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
                        <input type="text" id="nickname" class="form-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
                    </div>
                </div>
            </div>

            <!-- Section 2: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
            <div class="card lg:col-span-1">
                <h2 class="section-header">2.‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
                <div class="space-y-4">
                    <div>
                        <label for="student-status" class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                        <select id="student-status" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                            <option value="old">‡πÄ‡∏Å‡πà‡∏≤</option>
                            <option value="new">‡πÉ‡∏´‡∏°‡πà</option>
                        </select>
                    </div>
                    <div>
                        <label for="application-type" class="form-label">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
                        <select id="application-type" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</option>
                            <option value="Line">Line</option>
                            <option value="Walk in">Walk in</option>
                        </select>
                    </div>
                    <div>
                        <label for="academic-year" class="form-label">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</label>
                        <select id="academic-year" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                            <option value="2567">2567</option>
                            <option value="2568">2568</option>
                            <option value="2569">2569</option>
                            <option value="2570">2570</option>
                        </select>
                    </div>
                    <div>
                        <label for="branch" class="form-label">‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <select id="branch" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
                            <option value="megabangna">‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏°‡∏Å‡∏≤‡∏ö‡∏≤‡∏á‡∏ô‡∏≤</option>
                            <option value="sukhapiban3">‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏• 3</option>
                            <option value="megabangna-off-account">‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏°‡∏Å‡∏≤‡∏ö‡∏≤‡∏á‡∏ô‡∏≤ (‡∏ô‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ)</option>
                            <option value="sukhapiban3-off-account">‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏• 3 (‡∏ô‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ)</option>
                        </select>
                    </div>
                    <div>
                        <label for="application-date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</label>
                        <input type="date" id="application-date" class="form-field">
                    </div>
                    <div>
                        <label for="program" class="form-label">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</label>
                        <select id="program" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</option>
                            <option value="ALC">ALC</option>
                            <option value="TCH">TCH</option>
                        </select>
                    </div>
                    <div>
                        <label for="Season" class="form-label">‡∏ã‡∏µ‡πà‡∏ã‡∏±‡πà‡∏ô</label>
                        <select id="Season" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏µ‡∏ã‡∏±‡πà‡∏ô</option>
                            <option value="S1">1</option>
                            <option value="S2">2</option>
                            <option value="S3">3</option>
                            <option value="S4">4</option>
                            <option value="All">‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</option>
                        </select>
                    </div>
                    <div>
                        <label for="class" class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö</label>
                        <select id="class" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô</option>
                            <option value="p6">‡∏õ.6</option>
                            <option value="m3">‡∏°.3</option>
                            <option value="m4">‡∏°.4</option>
                            <option value="m5">‡∏°.5</option>
                            <option value="m6">‡∏°.6</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Section 3: ‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£ -->
            <div class="card lg:col-span-2 lg:col-start-3 lg:row-start-1 flex flex-col">
                <h2 class="section-header">3.‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h2>
                <!-- Course selection and add area -->
                <div class="flex items-end gap-2 mb-4">
                    <div class="flex-grow">
                        <label for="course-select" class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                        <select id="course-select" class="form-field">
                            <option value="">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏¥‡∏ä‡∏≤...</option>
                        </select>
                    </div>
                    <button id="add-course-button" class="detail-action-button bg-orange-500 hover:bg-orange-600 px-4 py-2">
                        <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
                    </button>
                </div>
                
                <!-- Course table -->
                <div class="course-table-container">
                    <div class="course-table-wrapper">
                        <table class="course-table">
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th>
                                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏£‡πå‡∏™</th>
                                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                    <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                    <th>‡∏•‡∏ö</th>
                                </tr>
                            </thead>
                            <tbody id="selected-courses-table-body">
                                <!-- Dynamically added courses will go here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Section 4: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ä‡∏≥‡∏£‡∏∞ -->
            <div class="card lg:col-span-1">
                <h2 class="section-header">4.‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ä‡∏≥‡∏£‡∏∞</h2>
                <div class="space-y-4">
                    <div>
                        <label for="promotion" class="form-label">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô</label>
                        <input type="text" id="promotion" class="form-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô">
                    </div>
                    <div>
                        <label for="discount" class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</label>
                        <input type="text" id="discount" class="form-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î">
                    </div>
                    <div>
                        <label for="payment-method" class="form-label">‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏ö‡∏ö</label>
                        <select id="payment-method" class="form-field">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</option>
                            <option value="cash">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
                            <option value="transfer">‡πÇ‡∏≠‡∏ô</option>
                            <option value="credit">‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</option>
                        </select>
                    </div>
                    <div>
                        <label for="notes" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                        <textarea id="notes" rows="3" class="form-field" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"></textarea>
                    </div>
                </div>
            </div>

            <!-- Section 5: ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î -->
            <div class="card lg:col-span-1">
                <h2 class="section-header">5.‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</h2>
                <div class="space-y-4">
                    <div>
                        <label for="total-amount" class="form-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</label>
                        <input type="text" id="total-amount" class="form-field" readonly>
                    </div>
                    <div>
                        <label for="fees" class="form-label">‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</label>
                        <input type="text" id="fees" class="form-field" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°">
                    </div>
                    <div>
                        <label for="net-amount" class="form-label">‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</label>
                        <input type="text" id="net-amount" class="form-field" readonly>
                    </div>
                </div>
            </div>
            
            <!-- Save button (placed outside the grid for full width control) -->
            <div class="mt-8 col-span-full flex justify-center">
                <button id="save-button" class="detail-action-button bg-blue-600 hover:bg-blue-700 w-full md:w-auto px-8 py-3 rounded-xl shadow-lg">
                    <i class="fas fa-save mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                </button>
            </div>

        </div>
    </div>

    <!-- Message box for notifications -->
    <div id="infoMessageBox" class="message-box"></div>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycbxWtZcyQIUQNxexbxEYSrjjEb955nnhtuRiuWJ9MRb5RyH6lu_SDhddI7tiOJ2IXYGN/exec';

  async function fetchStudentDetails() {
    const idCard = document.getElementById('idCard').value.trim();
    if (!idCard) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô");

    try {
      const response = await fetch(`${API_URL}?idCard=${idCard}`);
      const data = await response.json();

      if (!data || data.error) {
        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö");
        return;
      }

      document.getElementById('studentCode').value = data['‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'];
      document.getElementById('firstName').value = data['‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á'];
      document.getElementById('lastName').value = data['‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'];
      document.getElementById('nickname').value = data['‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô'] || '';

    } catch (err) {
      console.error("Fetch error:", err);
      alert("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ");
    }
  }

  async function saveStudentNickname() {
    const idCard = document.getElementById('idCard').value.trim();
    const nickname = document.getElementById('nickname').value.trim();
    if (!idCard || !nickname) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô");

    const body = new URLSearchParams();
    body.append('idCard', idCard);
    body.append('nickname', nickname);
    body.append('action', 'updateNickname');

    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body
      });

      alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    } catch (err) {
      console.error("Save nickname error:", err);
      alert("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }
  }

  // Event binding ‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏ô HTML (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ ID ‡∏´‡∏£‡∏∑‡∏≠ onclick ‡∏Å‡πá‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
  window.fetchStudentDetails = fetchStudentDetails;
  window.saveStudentNickname = saveStudentNickname;
</script>

</body>
</html>
